#!/bin/sh
# Attach to existing tmux session or run $PROGRAM inside newly spawned one
# USAGE:	$ ln -s ${HOME}/tmuxify ${HOME}/mutt && mutt

# The program's name
name="${0##*/}"
# This script's absoloute directory
path=$(readlink "${0}")
# First binary found in $PATH not being this script itself
exe=$(which -a "${name}" \
		| grep -v -E "^(${path%/*}|$(cd "${0%/*}" && pwd))" \
		| head -n1)

[ -z "${exe}" ] \
	&& printf '"%s" not found in $PATH.' "${name}" 1>&2 \
	&& exit 1

tmux has-session -t "${name}" \
	&& exec tmux attach-session -t "${name}" \
	|| exec tmux new-session -n "${name}" -s "${name}" \
		"${exe}" ${@}
